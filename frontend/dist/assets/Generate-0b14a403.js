import{r as i,q as C,a as n,b as f,d as g,e as r,f as a,w as o,n as N,t as d,g as c,j as F}from"./index-65be5f2e.js";import{_ as B,d as D,f as U}from"./_plugin-vue_export-helper-5f0f1ec2.js";const $={class:"container"},E={class:"section"},j={key:0,class:"status-section"},A={class:"status-message"},L={class:"time-info"},R={key:1,class:"result-section"},W={key:2,class:"error-section"},z={__name:"Generate",setup(H){const s=i({srcFile:"",dstFile:""}),v=i(!1),_=i(""),b=i(""),t=i(null),u=i(null),x=()=>{if(!t.value)return"";switch(t.value.status){case"pending":return"准备生成数据库...";case"processing":return"正在生成数据库，请稍候...";case"completed":return"数据库生成完成";case"failed":return"生成失败: "+(t.value.errorMessage||"未知错误");default:return t.value.status}},h=l=>l?new Date(l).toLocaleString():"未知",k=()=>{if(!t.value||!t.value.durationSeconds)return"0秒";const l=Math.floor(t.value.durationSeconds),e=Math.floor(l/3600),p=Math.floor(l%3600/60),m=l%60;return`${e.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`},V=async()=>{if(b.value)try{const l=await U(b.value);t.value=l.data,(t.value.status==="completed"||t.value.status==="failed")&&(clearInterval(u.value),v.value=!1)}catch(l){console.error("查询任务状态失败:",l),clearInterval(u.value),v.value=!1}},I=async()=>{if(!s.value.srcFile||!s.value.dstFile){_.value="请输入源文件路径和目标文件路径";return}v.value=!0,_.value="",t.value=null;try{u.value&&clearInterval(u.value);const l=await D(s.value.srcFile,s.value.dstFile);b.value=l.data.taskId,u.value=setInterval(V,1e3)}catch(l){_.value=l.message||"生成数据库失败",v.value=!1}};return C(()=>{u.value&&clearInterval(u.value)}),(l,e)=>{const p=n("el-input"),m=n("el-form-item"),w=n("el-button"),M=n("el-form"),T=n("el-divider"),S=n("el-descriptions-item"),G=n("el-descriptions"),P=n("el-result"),q=n("el-alert");return f(),g("div",$,[r("div",E,[e[8]||(e[8]=r("h2",{class:"section-title"},"生成数据库",-1)),a(M,{model:s.value,"label-width":"120px",onSubmit:N(I,["prevent"])},{default:o(()=>[a(m,{label:"源文件路径",required:""},{default:o(()=>[a(p,{modelValue:s.value.srcFile,"onUpdate:modelValue":e[0]||(e[0]=y=>s.value.srcFile=y),placeholder:"请输入源文件路径，如：data/ip.merge.txt"},null,8,["modelValue"]),e[2]||(e[2]=r("div",{class:"form-item-help"},"源文件需要是IP2Region支持的文本格式，每行格式为：startIP|endIP|国家|区域|省份|城市|ISP",-1))]),_:1,__:[2]}),a(m,{label:"目标文件路径",required:""},{default:o(()=>[a(p,{modelValue:s.value.dstFile,"onUpdate:modelValue":e[1]||(e[1]=y=>s.value.dstFile=y),placeholder:"请输入目标文件路径，如：data/ip2region.xdb"},null,8,["modelValue"]),e[3]||(e[3]=r("div",{class:"form-item-help"},"目标文件是生成的二进制数据库文件，扩展名通常为.xdb",-1))]),_:1,__:[3]}),a(m,null,{default:o(()=>[a(w,{type:"primary",onClick:I,loading:v.value},{default:o(()=>e[4]||(e[4]=[c("生成数据库")])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1},8,["model"]),a(T),t.value&&(t.value.status==="pending"||t.value.status==="processing")?(f(),g("div",j,[e[6]||(e[6]=r("h3",null,"生成状态",-1)),r("p",A,d(x()),1),r("p",L,[c(" 开始时间: "+d(h(t.value.startTime)),1),e[5]||(e[5]=r("br",null,null,-1)),c(" 已耗时: "+d(k()),1)])])):F("",!0),t.value&&t.value.status==="completed"?(f(),g("div",R,[e[7]||(e[7]=r("h3",null,"生成结果",-1)),a(P,{icon:"success",title:"数据库生成成功","sub-title":"数据库文件已成功生成"},{extra:o(()=>[a(G,{column:1,border:""},{default:o(()=>[a(S,{label:"源文件"},{default:o(()=>[c(d(s.value.srcFile),1)]),_:1}),a(S,{label:"目标文件"},{default:o(()=>[c(d(s.value.dstFile),1)]),_:1}),a(S,{label:"耗时"},{default:o(()=>[c(d(k()),1)]),_:1})]),_:1})]),_:1})])):F("",!0),_.value||t.value&&t.value.status==="failed"?(f(),g("div",W,[a(q,{title:_.value||t.value.errorMessage,type:"error",description:"请检查文件路径是否正确，源文件是否存在且格式正确","show-icon":"",closable:!1},null,8,["title"])])):F("",!0)])])}}},O=B(z,[["__scopeId","data-v-1a87c502"]]);export{O as default};
