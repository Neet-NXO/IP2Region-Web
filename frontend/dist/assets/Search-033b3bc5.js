import{_ as P,s as I,b as R}from"./_plugin-vue_export-helper-5f0f1ec2.js";import{E as m,a as i,b as c,d as _,e as l,h as v,w as r,f as o,j as f,n as C,g as d,t as n,p as B}from"./index-65be5f2e.js";const N={name:"Search",data(){return{loading:!1,searchForm:{ip:"",searchMode:"file",dbPath:"ip2region.xdb"},searchResult:null,status:null}},mounted(){this.fetchStatus()},watch:{"searchForm.searchMode"(t,e){var g;e&&t!==e&&(t==="file"?this.$nextTick(()=>{m.info("已切换到文件模式，每次查询会根据操作系统缓存情况产生不同的IO次数")}):(g=this.status)!=null&&g.loaded&&this.status.searchMode!==t&&m.warning(`当前数据库加载为${this.getModeText(this.status.searchMode)}，建议使用已加载的模式以获得最佳性能`))}},methods:{async handleSearch(){var t;if(!this.searchForm.ip.trim()){m.warning("请输入IP地址");return}if(this.searchForm.searchMode!=="file"&&!((t=this.status)!=null&&t.loaded)){m.warning(`${this.getModeText(this.searchForm.searchMode)}需要先加载数据库`);return}this.loading=!0;try{const e=await I(this.searchForm.ip,this.searchForm.dbPath,this.searchForm.searchMode);this.searchResult=e.data,m.success("查询成功")}catch(e){console.error("查询失败:",e),m.error(e.message||"查询失败"),this.searchResult=null}finally{this.loading=!1}},async fetchStatus(){try{const t=await R();this.status=t.data,this.autoSelectSearchMode()}catch(t){console.error("获取状态失败:",t)}},autoSelectSearchMode(){var t,e;(t=this.status)!=null&&t.loaded&&((e=this.status)!=null&&e.searchMode)&&(this.searchForm.searchMode=this.status.searchMode,(this.status.searchMode==="memory"||this.status.searchMode==="vector")&&(this.searchForm.dbPath=""))},goToHome(){this.$router.push("/")},formatTime(t){return t<1e3?`${t} ns`:t<1e6?`${(t/1e3).toFixed(2)} μs`:t<1e9?`${(t/1e6).toFixed(2)} ms`:`${(t/1e9).toFixed(2)} s`},getModeText(t){switch(t){case"file":return"文件模式";case"vector":return"向量模式";case"memory":return"内存模式";default:return"未知模式"}},getModeTagType(t){switch(t){case"file":return"info";case"vector":return"warning";case"memory":return"success";default:return"info"}}}},E={class:"container"},K={class:"section"},O={key:0,class:"status-info mb-20"},U={key:2,class:"mode-tip"},z={class:"flex-row"},D={key:1,class:"xdb-warning mt-20"},H={class:"alert-actions"},j={key:2,class:"file-mode-tip mt-20"},q={key:3,class:"result-section"},X={class:"region-text"};function A(t,e,g,G,s,a){var T;const u=i("el-tag"),y=i("el-alert"),M=i("el-radio"),w=i("el-radio-group"),b=i("el-form-item"),x=i("el-input"),F=i("el-button"),k=i("el-form"),S=i("el-divider"),h=i("el-descriptions-item"),V=i("el-descriptions");return c(),_("div",E,[l("div",K,[e[10]||(e[10]=l("h2",{class:"section-title"},"IP地址查询",-1)),s.status?(c(),_("div",O,[s.status.loaded?(c(),v(u,{key:0,type:"success"},{default:r(()=>[d(" 数据库已加载 - "+n(a.getModeText(s.status.searchMode)),1)]),_:1})):(c(),v(u,{key:1,type:"info"},{default:r(()=>e[3]||(e[3]=[d("未加载数据库")])),_:1,__:[3]})),s.status.loaded?(c(),_("div",U,[o(y,{title:`已自动选择${a.getModeText(s.status.searchMode)}`,type:"success",description:`检测到数据库已加载为${a.getModeText(s.status.searchMode)}，已自动为您选择此模式以获得最佳性能。`,"show-icon":"",closable:!1,size:"small"},null,8,["title","description"])])):f("",!0)])):f("",!0),o(k,{model:s.searchForm,"label-width":"140px",onSubmit:C(a.handleSearch,["prevent"])},{default:r(()=>[o(b,{label:"搜索模式"},{default:r(()=>[o(w,{modelValue:s.searchForm.searchMode,"onUpdate:modelValue":e[0]||(e[0]=p=>s.searchForm.searchMode=p)},{default:r(()=>[o(M,{value:"file"},{default:r(()=>e[4]||(e[4]=[l("div",{class:"mode-option"},[l("div",{class:"mode-name"},"文件模式"),l("div",{class:"mode-desc"},"每次查询从文件读取，内存占用最低")],-1)])),_:1,__:[4]}),o(M,{value:"vector"},{default:r(()=>e[5]||(e[5]=[l("div",{class:"mode-option"},[l("div",{class:"mode-name"},"向量模式"),l("div",{class:"mode-desc"},"缓存向量索引，平衡内存和性能")],-1)])),_:1,__:[5]}),o(M,{value:"memory"},{default:r(()=>e[6]||(e[6]=[l("div",{class:"mode-option"},[l("div",{class:"mode-name"},"内存模式"),l("div",{class:"mode-desc"},"全部数据加载到内存，性能最佳")],-1)])),_:1,__:[6]})]),_:1},8,["modelValue"])]),_:1}),s.searchForm.searchMode==="file"?(c(),v(b,{key:0,label:"数据库文件"},{default:r(()=>[o(x,{modelValue:s.searchForm.dbPath,"onUpdate:modelValue":e[1]||(e[1]=p=>s.searchForm.dbPath=p),placeholder:"请输入.xdb数据库文件路径，如: ip2region.xdb"},null,8,["modelValue"])]),_:1})):f("",!0),o(b,{label:"IP地址"},{default:r(()=>[l("div",z,[o(x,{modelValue:s.searchForm.ip,"onUpdate:modelValue":e[2]||(e[2]=p=>s.searchForm.ip=p),placeholder:"请输入IP地址，如: 114.114.114.114",onKeyup:B(a.handleSearch,["enter"])},null,8,["modelValue","onKeyup"]),o(F,{type:"primary",class:"ml-10",onClick:a.handleSearch,loading:s.loading},{default:r(()=>e[7]||(e[7]=[d("查询")])),_:1,__:[7]},8,["onClick","loading"])])]),_:1})]),_:1},8,["model","onSubmit"]),s.searchForm.searchMode!=="file"&&!((T=s.status)!=null&&T.loaded)?(c(),_("div",D,[o(y,{title:`${a.getModeText(s.searchForm.searchMode)}需要先加载数据库`,type:"warning",description:`${a.getModeText(s.searchForm.searchMode)}需要先在首页加载XDB文件。点击按钮前往首页加载，或切换到文件模式进行查询。`,"show-icon":"",closable:!1},{default:r(()=>[l("div",H,[o(F,{type:"primary",size:"small",onClick:a.goToHome},{default:r(()=>e[8]||(e[8]=[d(" 前往首页加载 ")])),_:1,__:[8]},8,["onClick"])])]),_:1},8,["title","description"])])):f("",!0),s.searchForm.searchMode==="file"?(c(),_("div",j,[o(y,{title:"文件模式性能说明",type:"info",description:"文件模式下，初次查询会从硬盘读取数据，后续查询相同或相近IP地址时，由于操作系统的文件缓存机制，查询速度会显著提升，IO操作次数可能为0。这是正常现象，不是程序bug。","show-icon":"",closable:!0})])):f("",!0),o(S),s.searchResult?(c(),_("div",q,[e[9]||(e[9]=l("h3",null,"查询结果",-1)),o(V,{column:2,border:""},{default:r(()=>[o(h,{label:"查询IP"},{default:r(()=>[o(u,{type:"primary"},{default:r(()=>[d(n(s.searchForm.ip),1)]),_:1})]),_:1}),o(h,{label:"归属地信息"},{default:r(()=>[l("span",X,n(s.searchResult.region),1)]),_:1}),o(h,{label:"搜索模式"},{default:r(()=>[o(u,{type:a.getModeTagType(s.searchResult.searchMode)},{default:r(()=>[d(n(a.getModeText(s.searchResult.searchMode)),1)]),_:1},8,["type"])]),_:1}),o(h,{label:"IO操作次数"},{default:r(()=>[o(u,{type:s.searchResult.ioCount===0?"success":"warning"},{default:r(()=>[d(n(s.searchResult.ioCount)+" 次 ",1)]),_:1},8,["type"])]),_:1}),o(h,{label:"查询耗时"},{default:r(()=>[o(u,{type:"info"},{default:r(()=>[d(n(a.formatTime(s.searchResult.tookNanoseconds)),1)]),_:1})]),_:1}),o(h,{label:"查询时间"},{default:r(()=>[l("span",null,n(s.searchResult.queryTime),1)]),_:1})]),_:1})])):f("",!0)])])}const Q=P(N,[["render",A],["__scopeId","data-v-8bc6fd9b"]]);export{Q as default};
